{% extends "base.html" %}
{% block html_lang %}{{ page.lang }}{% endblock %}
{% block title %}{{ page.title|striptags }}{% endblock %}

{% block meta_description %}Glen Striders Club Shop - Running gear and fitness apparel for athletes in Glen-View, Budiriro, Glen Norah, and High Glen, Harare, Zimbabwe{% endblock %}
{% block meta_keywords %}running gear Harare, fitness apparel Glen-View, running clothes Zimbabwe, sports wear Budiriro, athletic wear Glen Norah, running vest High Glen, fitness merchandise Harare{% endblock %}

{% block extra_head %}
  {% import 'translations.html' as translations with context %}
  {% if translations.entry_hreflang(page) %}
    {{ translations.entry_hreflang(page) }}
  {% endif %}
{% endblock %}

{% block hero %}{% endblock %}
{% block home_sections %}{% endblock %}

{% block content %}
<!-- Hidden content for JavaScript parsing -->
<div id="page-content-source" style="display: none;">
  {{ page.content }}
</div>

<!-- Shop Page -->
<section id="shop" class="about section">
  <div class="container" data-aos="fade-up" data-aos-delay="100">
    
    <!-- Page Title -->
    <div class="row justify-content-center mb-5">
      <div class="col-lg-8 text-center" data-aos="fade-up" data-aos-delay="200">
        <h2 class="section-heading">Glen Striders Club Shop</h2>
        <p class="lead">Get your official Glen Striders running gear! Show your club pride with our quality merchandise.</p>
      </div>
    </div>

    <!-- Shop Items - Dynamically generated from markdown content -->
    <div class="row g-4 mb-5 justify-content-center" id="shop-items">
      <!-- Items will be inserted here by JavaScript -->
    </div>

    <!-- How to Order Section -->
    <div class="row justify-content-center mt-5">
      <div class="col-lg-8 text-center" data-aos="fade-up">
        <div style="padding: 2rem; background: color-mix(in srgb, var(--accent-color), transparent 90%); border-radius: 12px;">
          <h3 style="color: var(--accent-color);">How to Order</h3>
          <p class="lead mb-4">Click the "Order via WhatsApp" button on any product, fill in your details, and we'll send your order directly to our WhatsApp. We'll confirm availability and arrange payment and delivery.</p>
        </div>
      </div>
    </div>

  </div>
</section>

<script>
// Parse shop items from markdown content
document.addEventListener('DOMContentLoaded', function() {
  const contentDiv = document.getElementById('page-content-source');
  if (!contentDiv) {
    console.error('Content source div not found');
    return;
  }
  
  const content = contentDiv.innerHTML;
  const shopItems = [];
  
  // Create a temporary div to parse HTML
  const tempDiv = document.createElement('div');
  tempDiv.innerHTML = content;
  
  // Find all h4 elements (product titles)
  const h4Elements = tempDiv.querySelectorAll('h4');
  
  h4Elements.forEach((h4, index) => {
    const titleText = h4.textContent.trim();
    const titleMatch = titleText.match(/(.+?)\s+-\s+(.+)/);
    
    if (titleMatch) {
      const item = {
        title: titleMatch[1].trim(),
        price: titleMatch[2].trim(),
        description: '',
        image: '',
        type: 'product'
      };
      
      // Get following elements until next h4 or hr
      let nextElement = h4.nextElementSibling;
      while (nextElement) {
        if (nextElement.tagName === 'H4' || nextElement.tagName === 'HR') {
          break;
        }
        
        if (nextElement.tagName === 'P') {
          const text = nextElement.textContent.trim();
          if (text.startsWith('Image:')) {
            item.image = text.replace('Image:', '').trim();
          } else if (text.startsWith('Type:')) {
            item.type = text.replace('Type:', '').trim().toLowerCase();
          } else if (!item.description) {
            item.description = text;
          }
        }
        
        nextElement = nextElement.nextElementSibling;
      }
      
      shopItems.push(item);
    }
  });
  
  // Render shop items
  const container = document.getElementById('shop-items');
  if (container && shopItems.length > 0) {
    shopItems.forEach((item, index) => {
      const delay = (index + 1) * 100;
      const itemType = item.type === 'membership' ? 'subscription' : item.title.toLowerCase().replace(/\s+/g, '');
      
      let imageHtml = '';
      if (item.image) {
        imageHtml = `<img src="{{ SITEURL }}/{{ THEME_STATIC_DIR }}/img/shop/${item.image}" alt="${item.title}" class="img-fluid" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">`;
      } else if (item.type === 'membership') {
        imageHtml = `<div style="display: flex; align-items: center; justify-content: center; height: 250px; background: color-mix(in srgb, var(--accent-color), transparent 90%); border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
          <i class="bi bi-people-fill" style="font-size: 80px; color: var(--accent-color);"></i>
        </div>`;
      }
      
      const html = `
        <div class="col-md-6 col-lg-4" data-aos="fade-up" data-aos-delay="${delay}">
          <div class="feature-box text-center">
            <div class="shop-item-image mb-4">
              ${imageHtml}
            </div>
            <h4>${item.title}</h4>
            <h3 style="color: var(--accent-color); margin: 1rem 0;">${item.price}</h3>
            <p>${item.description}</p>
            <div class="mt-3">
              <button class="btn btn-whatsapp" onclick="openOrderForm('${itemType}')">
                <i class="bi bi-whatsapp"></i> ${item.type === 'membership' ? 'Subscribe' : 'Order'} via WhatsApp
              </button>
            </div>
          </div>
        </div>
      `;
      
      container.innerHTML += html;
    });
  } else {
    container.innerHTML = '<div class="col-12"><p class="text-center">No products available at this time.</p></div>';
  }
});
</script>

<!-- Order Forms Modal -->
<div class="modal fade" id="orderModal" tabindex="-1" aria-labelledby="orderModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="orderModalLabel">Place Your Order</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Vest/T-Shirt Form -->
        <form id="apparelForm" style="display: none;">
          <div class="mb-3">
            <label for="apparelName" class="form-label">Your Name</label>
            <input type="text" class="form-control" id="apparelName" required>
          </div>
          <div class="mb-3">
            <label for="apparelSize" class="form-label">Size</label>
            <select class="form-select" id="apparelSize" required>
              <option value="">Choose size...</option>
              <option value="Small">Small</option>
              <option value="Medium">Medium</option>
              <option value="Large">Large</option>
              <option value="Extra Large">Extra Large</option>
              <option value="XXL">XXL</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="apparelQuantity" class="form-label">Quantity</label>
            <input type="number" class="form-control" id="apparelQuantity" min="1" value="1" required>
          </div>
          <div class="mb-3">
            <label for="apparelNotes" class="form-label">Additional Notes (Optional)</label>
            <textarea class="form-control" id="apparelNotes" rows="2"></textarea>
          </div>
        </form>

        <!-- Subscription Form -->
        <form id="subscriptionForm" style="display: none;">
          <div class="mb-3">
            <label for="subscriberName" class="form-label">Your Name</label>
            <input type="text" class="form-control" id="subscriberName" required>
          </div>
          <div class="mb-3">
            <label for="subscriptionType" class="form-label">Subscription Type</label>
            <select class="form-select" id="subscriptionType" required>
              <option value="">Choose type...</option>
              <option value="Individual">Individual Membership</option>
              <option value="Couple">Couple Membership</option>
            </select>
          </div>
          <div class="mb-3" id="partnerNameDiv" style="display: none;">
            <label for="partnerName" class="form-label">Partner's Name</label>
            <input type="text" class="form-control" id="partnerName">
          </div>
          <div class="mb-3">
            <label for="subscriberPhone" class="form-label">Your Phone Number</label>
            <input type="tel" class="form-control" id="subscriberPhone" required>
          </div>
          <div class="mb-3">
            <label for="subscriberNotes" class="form-label">Additional Information (Optional)</label>
            <textarea class="form-control" id="subscriberNotes" rows="2"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-whatsapp" onclick="submitOrder()">
          <i class="bi bi-whatsapp"></i> Send to WhatsApp
        </button>
      </div>
    </div>
  </div>
</div>

<style>
/* WhatsApp Button Styling */
.btn-whatsapp {
  background-color: #25D366;
  border-color: #25D366;
  color: white;
  padding: 0.75rem 1.5rem;
  font-weight: 500;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.btn-whatsapp:hover {
  background-color: #20BA5A;
  border-color: #20BA5A;
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(37, 211, 102, 0.3);
}

.btn-whatsapp:active {
  transform: translateY(0);
}

.btn-whatsapp i {
  margin-right: 0.5rem;
  font-size: 1.1em;
}
</style>

<script src="{{ SITEURL }}/{{ THEME_STATIC_DIR }}/js/shop.js"></script>
{% endblock %}
